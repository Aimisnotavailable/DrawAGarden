<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garden Sim: Atmosphere Edition</title>
    <style>
        :root { --bg: #1a1a1a; --panel: #2d2d2d; --accent: #4caf50; --text: #e0e0e0; }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', monospace; color: var(--text); }
        
        /* Game View */
        #game-container { position: relative; width: 100vw; height: 100vh; background: #154618; }
        canvas#gameCanvas { display: block; width: 100%; height: 100%; }

        /* UI Overlay */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        /* THE NEW HUD BAR */
        .hud-bar { 
            position: absolute; top: 10px; left: 10px; right: 10px; 
            display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; 
            pointer-events: auto; 
        }
        
        .panel { 
            background: rgba(0,0,0,0.6); 
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.2); 
            padding: 8px 16px; 
            border-radius: 20px; 
            font-weight: bold; 
            font-size: 14px;
            display: flex; 
            align-items: center; 
            gap: 8px;
            color: #fff;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .panel-icon { font-size: 1.2em; }
        .panel-label { color: #aaa; margin-right: 4px; font-weight: normal; font-size: 0.9em; }

        /* Editor Modal */
        #editor-modal { 
            display: none; position: absolute; top: 50%; left: 50%; 
            transform: translate(-50%, -50%); 
            background: var(--panel); padding: 20px; border-radius: 8px;
            border: 1px solid #555; box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            pointer-events: auto; text-align: center; z-index: 100; width: 340px;
        }

        /* Layer Tabs */
        .tabs { display: flex; gap: 5px; margin-bottom: 15px; justify-content: center; }
        .tab-btn { 
            background: #222; border: 1px solid #444; color: #888; 
            padding: 6px 12px; cursor: pointer; border-radius: 4px; font-size: 0.85em; flex: 1;
        }
        .tab-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }

        /* Drawing Surface */
        .canvas-stack-container {
            position: relative; width: 160px; height: 160px; margin: 0 auto 15px;
            background: #111; border: 2px solid #555;
            background-image: radial-gradient(#333 1px, transparent 1px); background-size: 10px 10px;
            transform: scale(1.5); transform-origin: top center; margin-bottom: 90px;
        }
        
        .layer-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; image-rendering: pixelated; }
        .layer-canvas.active { opacity: 1.0; z-index: 10; pointer-events: auto; cursor: crosshair; }
        .layer-canvas.inactive { opacity: 0.4; z-index: 1; pointer-events: none; }

        /* Controls */
        .palette { display: flex; flex-wrap: wrap; justify-content: center; gap: 4px; margin-bottom: 15px; }
        .swatch { width: 24px; height: 24px; border-radius: 50%; cursor: pointer; border: 2px solid #444; }
        .swatch:hover, .swatch.active { border-color: #fff; transform: scale(1.1); }
        
        .actions { display: flex; gap: 10px; }
        .btn-primary { flex: 2; background: var(--accent); color: white; border: none; padding: 10px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-danger { flex: 1; background: transparent; color: #ef5350; border: 1px solid #ef5350; padding: 10px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <div id="ui-layer">
            <div class="hud-bar">
                <div class="panel">
                    <span id="ui-time-icon" class="panel-icon">‚òÄÔ∏è</span> 
                    <span id="ui-time-text">12:00</span>
                </div>

                <div class="panel">
                    <span class="panel-label">Weather:</span>
                    <span id="ui-weather">Clear</span>
                </div>

                <div class="panel">
                    <span class="panel-label">Wind:</span>
                    <span id="ui-wind-speed">0</span> km/h 
                    <span id="ui-wind-arrow" style="display:inline-block; transform-origin: center;">‚û°</span>
                </div>

                <div class="panel">
                    üå± <span id="ui-plant-count">0</span>
                </div>

                <div class="panel">
                    üë§ <input type="text" id="username" value="Guest" style="background:transparent; border:none; color:var(--accent); width:80px; font-weight:bold;">
                </div>
            </div>

            <div id="editor-modal">
                <h3 style="margin-top:0; color:var(--accent)">Botanist's Bench</h3>
                
                <div class="tabs" id="layer-controls">
                    <button class="tab-btn active" id="btn-layer-stem" onclick="window.editor.setLayer('stem')">1. Stem</button>
                    <button class="tab-btn" id="btn-layer-leaves" onclick="window.editor.setLayer('leaves')">2. Leaf</button>
                    <button class="tab-btn" id="btn-layer-flower" onclick="window.editor.setLayer('flower')">3. Flower</button>
                </div>

                <div class="canvas-stack-container">
                    <canvas id="canvas-stem" class="layer-canvas active" width="160" height="160"></canvas>
                    <canvas id="canvas-leaves" class="layer-canvas inactive" width="160" height="160"></canvas>
                    <canvas id="canvas-flower" class="layer-canvas inactive" width="160" height="160"></canvas>
                </div>

                <div class="palette" id="palette-container"></div>

                <div class="actions">
                    <button class="btn-danger" id="btn-cancel">Cancel</button>
                    <button class="btn-danger" id="btn-clear" style="font-size: 0.8em">Clear Layer</button>
                    <button class="btn-primary" id="btn-save">PLANT!</button>
                </div>
            </div>
        </div>
    </div>
    <script type="module" src="src/main.js"></script>
</body>
</html>